# 用户权限管理文档

## 一、概述

### 1.1 文档目的
本文档详细描述视频监控信息管理系统中用户权限管理模块的设计和实现，包括用户管理、角色管理、权限分配、安全机制等核心功能。

### 1.2 系统用户类型
系统的用户包括以下几类：
- **监控管理人员**：负责视频信息的日常管理和监控设备维护
- **安全管理人员**：负责系统安全策略制定和安全事件处理
- **数据分析人员**：负责视频数据分析和统计报告生成
- **系统管理员**：负责系统整体管理和用户权限分配

## 二、功能需求

### 2.1 用户注册和登录
- **用户注册**：
  - 支持管理员创建新用户账户
  - 用户信息包括：用户名、密码、真实姓名、邮箱、手机号等
  - 注册时需要指定用户角色
  - 支持用户状态设置（正常/禁用）

- **用户登录**：
  - 支持用户名/密码登录方式
  - 用户身份验证和授权
  - 登录状态保持和会话管理
  - 记录用户登录时间和登录历史

### 2.2 用户信息管理
- **用户基本信息管理**：
  - 用户基本信息修改（真实姓名、邮箱、手机号）
  - 用户状态管理（启用/禁用）
  - 用户信息查询和列表展示
  - 用户信息批量导入和导出

- **密码管理**：
  - 用户密码修改功能
  - 密码强度验证
  - 密码加密存储（BCrypt算法）
  - 密码重置功能

### 2.3 用户角色管理
- **角色定义**：
  - 角色创建、修改和删除
  - 角色信息包括：角色名称、角色编码、角色描述
  - 支持以下预定义角色：
    - 超级管理员（SUPER_ADMIN）
    - 监控管理员（MONITOR_ADMIN）
    - 安全管理员（SECURITY_ADMIN）
    - 数据分析员（DATA_ANALYST）

- **角色分配**：
  - 为用户分配一个或多个角色
  - 支持角色的批量分配
  - 角色权限继承机制

### 2.4 用户权限分配
- **权限类型**：
  - **视频管理权限**：视频信息查询、新增、修改、删除、备份恢复
  - **视频分析权限**：视频内容分析、行为分析、事件检测、数据统计
  - **可视化权限**：地图展示、报表查看、实时预览
  - **系统管理权限**：用户管理、角色管理、权限管理

- **权限分配方式**：
  - 基于角色的权限分配（RBAC模型）
  - 支持细粒度权限控制
  - 权限组合和权限继承
  - 动态权限调整

## 三、安全需求

### 3.1 用户认证与授权
- **认证机制**：
  - 采用用户名/密码认证方式
  - 支持多重身份验证（可扩展）
  - 会话超时自动登出
  - 防暴力破解机制

- **授权机制**：
  - 基于角色的访问控制（RBAC）
  - 最小权限原则
  - 权限动态验证
  - 跨模块权限统一管理

### 3.2 数据安全
- **密码安全**：
  - 密码BCrypt加密存储
  - 密码强度要求（长度、复杂度）
  - 密码定期更换提醒
  - 历史密码不重复验证

- **数据加密**：
  - 敏感用户信息加密存储
  - 传输过程数据加密（HTTPS）
  - 数据库连接加密

### 3.3 安全审计
- **操作日志**：
  - 记录用户的所有操作行为
  - 包括登录/登出、权限变更、数据操作等
  - 日志信息包括：用户ID、操作时间、操作类型、操作结果、IP地址等

- **安全监控**：
  - 异常登录监控
  - 权限滥用检测
  - 系统运行状态监控
  - 安全事件告警机制

### 3.4 数据备份与恢复
- **定期备份**：
  - 用户信息定期自动备份
  - 权限配置备份
  - 操作日志备份

- **恢复机制**：
  - 支持数据恢复功能
  - 备份数据完整性验证
  - 灾难恢复预案

## 四、系统设计

### 4.1 用户权限管理模块架构
用户权限管理模块采用分层架构设计：

- **表示层**：用户界面，提供用户管理、角色管理、权限配置等操作界面
- **业务逻辑层**：处理用户认证、权限验证、角色分配等业务逻辑
- **数据访问层**：用户数据、角色数据、权限数据的存储和访问
- **数据存储层**：用户信息、角色权限等数据的持久化存储

### 4.2 功能子模块设计

#### 4.2.1 用户注册和登录子模块
- **功能职责**：
  - 接收用户的注册和登录信息
  - 验证用户身份和密码
  - 管理用户会话状态
  - 将用户信息存储到数据库中

- **主要接口**：
  - 用户注册接口
  - 用户登录接口
  - 用户登出接口
  - 会话验证接口

#### 4.2.2 用户信息管理子模块
- **功能职责**：
  - 接收用户修改的个人信息
  - 更新数据库中的用户信息
  - 提供用户信息查询功能
  - 处理用户状态管理

- **主要接口**：
  - 用户信息查询接口
  - 用户信息修改接口
  - 密码修改接口
  - 用户状态管理接口

#### 4.2.3 用户权限分配子模块
- **功能职责**：
  - 根据用户的角色分配相应的操作权限
  - 实现细粒度权限控制
  - 动态权限验证
  - 权限变更记录

- **主要接口**：
  - 权限分配接口
  - 权限查询接口
  - 权限验证接口
  - 权限变更接口

#### 4.2.4 用户角色管理子模块
- **功能职责**：
  - 角色的创建、修改和删除
  - 角色权限配置
  - 用户角色分配
  - 角色继承机制

- **主要接口**：
  - 角色管理接口
  - 角色权限配置接口
  - 用户角色分配接口
  - 角色查询接口

## 五、数据库设计

### 5.1 用户相关数据表
用户权限管理涉及以下主要数据表：

#### 5.1.1 用户信息表（user_info）
- **用途**：存储用户的基本信息和登录凭证
- **主要字段**：
  - id：用户ID（主键）
  - username：用户名（唯一）
  - password：密码（BCrypt加密）
  - real_name：真实姓名
  - email：邮箱
  - phone：手机号
  - status：状态（1-正常，0-禁用）
  - last_login_time：最后登录时间
  - create_time：创建时间
  - update_time：更新时间

#### 5.1.2 角色信息表（role_info）
- **用途**：存储系统角色定义信息
- **主要字段**：
  - id：角色ID（主键）
  - role_name：角色名称（唯一）
  - role_code：角色编码（唯一）
  - role_description：角色描述
  - status：状态（1-正常，0-删除）
  - create_time：创建时间
  - update_time：更新时间

#### 5.1.3 权限信息表（permission_info）
- **用途**：存储系统权限定义信息
- **主要字段**：
  - id：权限ID（主键）
  - permission_name：权限名称（唯一）
  - permission_code：权限编码（唯一）
  - permission_description：权限描述
  - permission_type：权限类型（1-菜单，2-按钮，3-接口）
  - status：状态（1-正常，0-删除）
  - create_time：创建时间

#### 5.1.4 用户角色关联表（user_role）
- **用途**：维护用户和角色的多对多关系
- **主要字段**：
  - id：关联ID（主键）
  - user_id：用户ID（外键）
  - role_id：角色ID（外键）
  - create_time：创建时间

#### 5.1.5 角色权限关联表（role_permission）
- **用途**：维护角色和权限的多对多关系
- **主要字段**：
  - id：关联ID（主键）
  - role_id：角色ID（外键）
  - permission_id：权限ID（外键）
  - create_time：创建时间

### 5.2 数据关系
- 用户与角色：多对多关系，通过user_role表关联
- 角色与权限：多对多关系，通过role_permission表关联
- 用户最终权限：通过角色继承获得，支持权限叠加

## 六、技术实现

### 6.1 技术选型
- **后端框架**：Spring Boot 3.4.5
- **持久层框架**：MyBatis Plus 3.5.5
- **数据库**：MySQL 8.0+
- **密码加密**：BCrypt算法
- **权限控制**：Spring Security + 自定义RBAC
- **日志框架**：Logback

### 6.2 关键技术点
- **密码安全**：使用BCrypt进行密码加密存储
- **会话管理**：基于JWT的无状态认证
- **权限拦截**：AOP切面实现权限验证
- **缓存机制**：Redis缓存用户权限信息
- **审计日志**：自定义注解记录操作日志

## 七、接口设计

### 7.1 用户管理接口
- POST /api/user/register - 用户注册
- POST /api/user/login - 用户登录
- POST /api/user/logout - 用户登出
- GET /api/user/info - 获取用户信息
- PUT /api/user/info - 更新用户信息
- PUT /api/user/password - 修改密码
- GET /api/user/list - 用户列表查询

### 7.2 角色管理接口
- POST /api/role - 创建角色
- PUT /api/role/{id} - 更新角色
- DELETE /api/role/{id} - 删除角色
- GET /api/role/list - 角色列表查询
- POST /api/role/{roleId}/permissions - 分配角色权限

### 7.3 权限管理接口
- GET /api/permission/list - 权限列表查询
- POST /api/user/{userId}/roles - 分配用户角色
- GET /api/user/{userId}/permissions - 获取用户权限

用户权限管理模块是整个视频监控信息管理系统的安全基础，通过完善的用户管理、角色分配和权限控制机制，确保系统的安全性和可靠性。本文档详细描述了模块的设计思路、实现方案和技术要点，为系统开发和维护提供了全面的指导。